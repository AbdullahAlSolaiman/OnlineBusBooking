DROP TABLE IF EXISTS booking;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS routes;

CREATE TABLE users (
    userid int NOT NULL AUTO_INCREMENT,
    fname varchar(255) ,
    lname varchar(255) ,
    phonenumber varchar(255) ,
    email varchar(255) ,
    username varchar(255) NOT NULL,
    level int NOT NULL,
    password varchar(255) NOT NULL, /*if using bcrypt use Binary(60) using VARCHAR(255) for testing*/
    PRIMARY KEY (userid)
);

CREATE TABLE routes (
    routeid int NOT NULL AUTO_INCREMENT,
    cost int,
    time VARCHAR(255),
    date VARCHAR(255) NOT NULL,
    origin VARCHAR(255) NOT NULL,
    destination VARCHAR(255) NOT NULL,
    available_seats_count int NOT NULL,
    PRIMARY KEY (routeid)  
);

CREATE TABLE booking (
  bookingid int NOT NULL AUTO_INCREMENT,
  userid int NOT NULL,
  routeid int NOT NULL,
  payment int NOT NULL,
  PRIMARY KEY (bookingid),
  FOREIGN KEY (userid) REFERENCES users (userid),
  FOREIGN KEY (routeid) REFERENCES routes (routeid)
);


INSERT INTO users (fname,lname,phonenumber,email,username,password,level)
VALUES ("adam", "bro", "1234567890", "adam@bus.com","admin","admin",1),
("noob", "csgotoohard", "987654321", "valisgood@bus.com","user","user",2);

INSERT INTO routes (cost,time,date,origin,destination,available_seats_count)
VALUES (100,"10:00","12/12/2003","foo","bar",50),
(50,"12:00","12/12/2004","bar","foo",50);

INSERT INTO booking (userid,routeid,payment)
VALUES (1,1,100),(2,2,50);

SELECT userid,username,level FROM users where username = "admin" AND password = "admin" LIMIT 1; 

SELECT origin,destination,date,cost FROM routes WHERE origin = "foo" AND destination = "bar" AND date = "12/12/2003" AND available_seats_count > 0;


SELECT booking.userid, users.username,routes.origin,routes.destination,routes.date FROM booking
    INNER JOIN routes
        ON booking.routeid = routes.routeid
    INNER JOIN  users
    	on booking.userid = users.userid;
        
SELECT * FROM routes WHERE routeid = 1;

UPDATE routes SET available_seats_count = available_seats_count-1 WHERE  routeid = 1;

DELETE FROM booking WHERE bookingid = 1;
